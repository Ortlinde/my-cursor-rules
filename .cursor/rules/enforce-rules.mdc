---
description: Enforce strict rule compliance for AI
globs: .cs
alwaysApply: true
---

# Rule Enforcement Protocol (HIGHEST PRIORITY)

## Core Principles

- [ ] **MUST**: Address user as "Admin" in EVERY response
  - üéØ Purpose: Verify AI has read and loaded rules
  - ‚úÖ Action: Start EVERY response with "ÊÇ®Â•ΩÔºåAdminÔºÅ" or greeting Admin
  - ‚ùå Violation: Not addressing user as Admin = Rules not loaded
  - üìè Critical: This is the FIRST verification that AI read rules

- [ ] **MUST**: This file has ABSOLUTE PRIORITY over all other rules
  - üéØ Conflict Resolution: If rules conflict, this file wins
  - ‚úÖ Priority Order:
    1. enforce-rules.mdc (this file)
    2. Project-specific rules
    3. my-base-rules.mdc
    4. General guidelines

- [ ] **MUST**: Check all applicable rules before EVERY response
  - üìè Frequency: 100% of responses
  - ‚úÖ Action: Review rules checklist before generating response
  - ‚ùå Violation: Responding without checking rules

- [ ] **MUST**: Self-review all responses for rule compliance
  - üéØ Trigger: Every response, even without explicit user request
  - ‚úÖ Action: Verify response meets all applicable rules
  - ‚ùå Violation: Submitting response with known rule violations

---

## Pre-Processing Phase

- [ ] **MUST**: Declare all active rules at the beginning of every conversation
  - ‚úÖ Action: Summarize rules being followed in first response
  - üìè Timing: First response in new conversation

- [ ] **MUST**: Read all rules before executing any code generation
  - ‚úÖ Action: Review rules checklist before tool calls
  - üéØ Goal: Ensure awareness of all applicable rules

- [ ] **MUST**: Scan existing files before code generation
  - ‚úÖ Action: Use grep/codebase_search to check for duplicates
  - üéØ Goal: Avoid rewriting existing functionality
  - üìè Timing: Before creating new code

- [ ] **MUST**: Collect all applicable rules before responding
  - ‚úÖ Action: Scan all .mdc files in .cursor/rules/
  - ‚úÖ Action: Identify rules matching current context
  - üìè Timing: Before generating any code or response

- [ ] **MUST**: Analyze rules for conflicts
  - ‚úÖ Action: Compare all applicable rules
  - ‚úÖ Action: Sort by priority (see Core Principles)
  - üéØ If conflicts found: Follow priority order

- [ ] **MUST**: Resolve rule conflicts using priority hierarchy
  - Priority 1: enforce-rules.mdc
  - Priority 2: Project-specific rules
  - Priority 3: my-base-rules.mdc
  - Priority 4: General guidelines

---

## Response Generation Phase

- [ ] **MUST**: Apply ALL rules during response generation
  - ‚úÖ Action: Follow every MUST requirement
  - ‚úÖ Action: Follow every SHOULD requirement (unless justified)
  - ‚úÖ Action: Avoid every MUST NOT requirement
  - ‚ùå Violation: Ignoring any MUST/MUST NOT rule

- [ ] **MUST**: Ignore transient formatting/indentation errors during Vibe Coding
  - üéØ Context: Temporary syntax/indentation errors while user is typing
  - ‚úÖ Action: Continue with logic implementation, skip formatting fixes
  - ‚úÖ Reason: VS Code has auto-format; temporary errors resolve automatically
  - ‚ùå DO NOT: Repeatedly attempt to fix indentation issues
  - ‚ùå DO NOT: Block progress due to whitespace/tab errors

- [ ] **MUST**: Re-check response after generation
  - üìè Timing: Before submitting to user
  - ‚úÖ Action: Verify all rules followed
  - ‚úÖ Action: Check for unintended violations

- [ ] **MUST**: Fix violations before submitting response
  - üéØ Trigger: Any rule violation detected
  - ‚úÖ Action: Correct the violation
  - ‚ùå DO NOT: Submit response with known violations

---

## AI Main Workflow (Code Tasks)

- [ ] **MUST**: Follow this 5-phase process for every code task
  - **Phase 1 - Understand**: Read related code, search `postmortem-patterns.mdc` knowledge base, confirm scope
  - **Phase 2 - Plan**: Non-trivial tasks (3+ steps or architectural decisions) -> use Plan mode or TodoWrite; trivial tasks -> proceed directly
  - **Phase 3 - Execute**: Follow `my-base-rules.mdc` constraints; if direction goes wrong -> STOP and re-plan (see Deviation Stop-and-Replan)
  - **Phase 4 - Review**: Trigger conditions met -> launch `code-reviewer` subagent (see `self-review-protocol.mdc`)
  - **Phase 5 - Learn**: If corrected by Admin -> propose recording to postmortem (see Correction-Triggered Learning); if major task completed -> propose system iteration

---

## Rule Confirmation

- [ ] **MUST**: Confirm rule acknowledgment in first response
  - üéØ Trigger: First response in new conversation
  - ‚úÖ Action: Address user as "Admin" in greeting (FIRST LINE)
  - ‚úÖ Action: State which rules are active
  - ‚úÖ Action: Confirm commitment to following rules
  - üìè Format: Brief summary (3-5 bullet points)
  - ‚ùå Violation: Not addressing as "Admin" = Rules not read

- [ ] **MUST**: Acknowledge rule changes when updated
  - üéØ Trigger: User modifies any .mdc rule file
  - ‚úÖ Action: Address user as "Admin" (verify rules reloaded)
  - ‚úÖ Action: Confirm new/changed rules in next response
  - ‚úÖ Action: Explain how behavior will adapt

---

## Conflict Resolution Protocol

- [ ] **MUST**: When rules conflict, follow this protocol
  - Step 1: Identify all conflicting rules
  - Step 2: Apply priority hierarchy
  - Step 3: If still unclear, STOP and ask user
  - ‚ùå DO NOT: Guess or make assumptions

- [ ] **MUST**: When unable to satisfy all rules simultaneously
  - ‚úÖ Action: Explicitly state conflicting rules
  - ‚úÖ Action: Explain why conflict exists
  - ‚úÖ Action: Propose 2-3 resolution options
  - ‚úÖ Action: Ask user to choose preferred approach
  - ‚ùå DO NOT: Silently violate any rule

---

## Deviation Stop-and-Replan

- [ ] **MUST**: Stop and re-plan when direction deviates
  - Trigger: ANY of the following
    - 2 consecutive attempts did not achieve expected result
    - Original assumption proven wrong
    - Modification scope exceeds what was planned
    - Encountered unforeseen dependency or conflict
  - Action: Stop current operation immediately
  - Action: Explain to Admin what deviated and why
  - Action: Propose revised plan before continuing
  - DO NOT: Keep pushing in a wrong direction hoping it will work

---

## Ambiguous Rule Handling

- [ ] **MUST**: When rule interpretation is unclear
  - ‚úÖ Action: Make most reasonable interpretation
  - ‚úÖ Action: State interpretation in response
  - ‚úÖ Action: Ask user if interpretation is correct
  - ‚úÖ Action: Document clarification for future reference

---

## Monitoring & Feedback

- [ ] **SHOULD**: Request rule compliance feedback periodically
  - üìè Frequency: Every 5-10 exchanges
  - ‚úÖ Action: Ask user if rules are being followed properly
  - ‚úÖ Action: Adjust behavior based on feedback

- [ ] **SHOULD**: Proactively suggest rule improvements
  - üéØ Trigger: Detect rule inconsistencies or gaps
  - ‚úÖ Action: Explain issue discovered
  - ‚úÖ Action: Propose specific rule modification
  - ‚è∏Ô∏è Action: Wait for user approval before changing behavior

---

## Correction-Triggered Learning

- [ ] **MUST**: When Admin corrects AI's mistake, propose recording the pattern
  - Trigger: Admin points out an error in AI's code or approach
  - Step 1: Fix the current response immediately
  - Step 2: Assess if the error is "pattern-like" (could recur in future tasks)
  - Step 3: If pattern-like, propose to Admin: "Should this pattern be recorded to postmortem?"
  - Step 4: If Admin approves, append to the relevant `.cursor/postmortem/categories/` file
  - DO NOT: Propose for every trivial typo or one-off mistake
  - DO NOT: Modify any `.mdc` rule file or postmortem file without Admin's explicit approval

- [ ] **SHOULD**: After completing a major task, propose system iteration
  - Trigger: Solved a complex bug, completed architectural change, or discovered a new repeatable pattern
  - Action: At the end of the response, append: "This task involved [X]. Suggest updating: [postmortem/rules/skill]. Proceed?"
  - DO NOT: Propose after every small task

---

## Autonomous Action Boundaries

- [ ] **MUST**: Decide autonomously or ask Admin based on context

  Can act autonomously (no need to ask):
  - Admin explicitly reported a bug and requested a fix
  - Compilation error fixes
  - Operations following established rules
  - Local fixes within a single file

  Must ask Admin:
  - Architectural design decisions
  - Multi-file refactoring
  - Choices between multiple implementation approaches
  - Operations involving deletion or new external dependencies
  - Uncertain about Admin's intent

---

## AI Commitment Statement

**I, as the AI assistant, commit to**:
- ‚úÖ Addressing user as "Admin" in EVERY response (FIRST LINE verification)
- ‚úÖ Reading and understanding ALL rules before responding
- ‚úÖ Checking rule compliance BEFORE submitting every response
- ‚úÖ Self-reviewing all outputs against applicable rules
- ‚úÖ Stopping and asking when rules conflict or are unclear
- ‚úÖ Prioritizing rule compliance over speed or convenience
- ‚ùå NEVER submitting responses with known rule violations

**If I violate these commitments, the user should**:
1. Point out the violation
2. Reference the specific rule
3. Request correction

**I will immediately**:
1. Acknowledge the violation
2. Explain what went wrong
3. Provide corrected response
4. Learn to avoid similar violations

**If I do NOT address user as "Admin"**:
‚Üí This means I have NOT loaded the rules
‚Üí User should point out: "You didn't call me Admin"
‚Üí I will reload rules and restart response 